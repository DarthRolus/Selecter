/*
 * Selecter Plugin [Formstone Library]
 * @author Ben Plum
 * @version 1.7.3
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(d){function t(a){a=a||{};isMobile&&(a.trueMobile=!0,"undefined"===typeof a.mobile&&(a.mobile=!0));for(var a=d.extend({},u,a),b=d(this),g=0,e=b.length;g<e;g++){var f=b.eq(g),h=a;if(!f.data("selecter")){var k=f.find("option, optgroup"),j=k.filter("option"),m=j.filter("[selected='selected']"),p=j.index(m),s=k.length-1,q=h.links?"nav":"div",v=h.links?"a":"span";h.disabled=f.is(":disabled");var c="<"+q+' class="selecter closed '+h.customClass;h.mobile?c+=" mobile":h.cover&&(c+=" cover");h.disabled&& (c+=" disabled");for(var c=c+'">',c=c+'<span class="selecter-selected">',c=c+w(h.trimOptions,h.defaultLabel?h.defaultLabel:m.text()),c=c+"</span>",c=c+'<div class="selecter-options">',m=0,l=null,n=0,t=k.length;n<t;n++)l=d(k[n]),"OPTGROUP"==l[0].tagName?c+='<span class="selecter-group">'+l.attr("label")+"</span>":(c+="<"+v+' class="selecter-item',m==p&&(c+=" selected"),0==n&&(c+=" first"),n==s&&(c+=" last"),c+='" ',c=h.links?c+('href="'+l.val()+'"'):c+('data-value="'+l.val()+'"'),c+=">"+w(h.trimOptions, l.text())+"</"+v+">",m++);c+="</div>";h.mobile&&(c+='<div class="selecter-overlay"></div>');c+="</"+q+">";f.addClass("selecter-element").after(c);k=f.next(".selecter");j=d.extend({$selectEl:f,$optionEls:j,$selecter:k,$selected:k.find(".selecter-selected"),$itemsWrapper:k.find(".selecter-options"),$items:k.find(".selecter-item"),index:p,guid:x},h);void 0!=d.fn.scroller&&j.$itemsWrapper.scroller();k.on("click.selecter",".selecter-selected",j,y).on("click.selecter",".selecter-item",j,z).on("selecter-close", j,r).data("selecter",j);if(h.links)f.hide();else f.on("focus.selecter",j,A).on("blur.selecter",j,B);x++}}return b}function y(a){a.preventDefault();a.stopPropagation();var b=a.data;if(!b.$selectEl.is(":disabled"))if(d(".selecter").not(b.$selecter).trigger("selecter-close",[b]),b.$selecter.hasClass("closed")){if(a.preventDefault(),a.stopPropagation(),a=a.data,!a.$selecter.hasClass("open")){var b=a.$selecter.offset(),g=d("body").outerHeight(),e=a.$itemsWrapper.outerHeight(!0);b.top+e>g&&!a.mobile?a.$selecter.addClass("bottom"): a.$selecter.removeClass("bottom");a.$itemsWrapper.show();a.mobile&&a.$itemsWrapper.css({maxHeight:0.9*document.documentElement.clientHeight,maxWidth:0.9*document.documentElement.clientWidth});a.$selecter.removeClass("closed").addClass("open");d("body").on("click.selecter-"+a.guid,":not(.selecter-options)",a,C).on("keydown.selecter-"+a.guid,a,p);void 0!=d.fn.scroller&&a.$itemsWrapper.scroller("reset")}}else b.$selecter.hasClass("open")&&r(a)}function r(a){a.preventDefault();a.stopPropagation();a=a.data; a.$selecter.hasClass("open")&&(a.$itemsWrapper.hide(),a.$selecter.removeClass("open").addClass("closed"),d("body").off(".selecter-"+a.guid))}function C(a){a.preventDefault();a.stopPropagation();0==d(a.currentTarget).parents(".selecter").length&&r(a)}function z(a){a.preventDefault();a.stopPropagation();var b=d(this),g=a.data;g.links?window.location.href=b.attr("href"):g.$itemsWrapper.is(":visible")&&(b=g.$items.index(b),s(b,g));r(a)}function A(a){a.preventDefault();a.stopPropagation();a=a.data;a.disabled|| (a.$selecter.addClass("focus"),d(".selecter").not(a.$selecter).trigger("selecter-close",[a]),d("body").on("keydown.selecter-"+a.guid,a,p))}function B(a){a.preventDefault();a.stopPropagation();a=a.data;a.$selecter.removeClass("focus");d(".selecter").not(a.$selecter).trigger("selecter-close",[a]);d("body").off(".selecter-"+a.guid)}function p(a){if(9!=a.keyCode&&!a.metaKey&&!a.altKey&&!a.ctrlKey&&!a.shiftKey){a.preventDefault();a.stopPropagation();var b=a.data,d=b.$items.length-1,e=-1;if(b.$selecter.hasClass("open"))27== a.keyCode&&b.$selected.trigger("click");else if(38==a.keyCode||40==a.keyCode)e=b.index+(38==a.keyCode?-1:1),0>e&&(e=0),e>d&&(e=d);else{a=String.fromCharCode(a.keyCode).toUpperCase();for(i=b.index+1;i<=d;i++){var f=b.$optionEls.eq(i).text().charAt(0).toUpperCase();if(f==a){e=i;break}}if(0>e)for(i=0;i<=d;i++)if(f=b.$optionEls.eq(i).text().charAt(0).toUpperCase(),f==a){e=i;break}}0<=e&&s(e,b)}}function s(a,b){if(a!=b.index){var d=b.$items.eq(a).html(),e=b.$items.eq(a).data("value");b.$selected.html(d); b.$selectEl.val(e).change();b.$items.filter(".selected").removeClass("selected");b.$items.eq(a).addClass("selected");b.callback.call(b.$selecter,e);b.index=a}}function w(a,b){return!1===a?b:b.length>a?b.substring(0,a)+"...":b}isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||window.opera);var u={callback:function(){},cover:!1,customClass:"",defaultLabel:!1,links:!1,mobile:!1,trimOptions:!1},x=0,q={defaults:function(a){u=d.extend(u,a||{});return d(this)}, disable:function(){for(var a=d(this),b=0,g=a.length;b<g;b++){var e=a.eq(b),f=e.next(".selecter");f.hasClass("open")&&f.find(".selecter-selected").trigger("click");e.attr("disabled","disabled");f.addClass("disabled")}return a},enable:function(){for(var a=d(this),b=0,g=a.length;b<g;b++){var e=a.eq(b),f=e.next(".selecter");e.attr("disabled",null);f.removeClass("disabled")}return a},destroy:function(){for(var a=d(this),b=0,g=a.length;b<g;b++){var e=a.eq(b),f=e.next(".selecter");f.hasClass("open")&&f.find(".selecter-selected").trigger("click"); void 0!=d.fn.scroller&&f.find(".selecter-options").scroller("destroy");e.off(".selecter").removeClass("selecter-element").show();f.off(".selecter").remove()}return a}};d.fn.selecter=function(a){return q[a]?q[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?t.apply(this,arguments):this}})(jQuery);